<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario con Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
</head>
<body>
  <h1>Inventario Digital</h1>

  <!-- Login y Registro -->
  <div id="authSection">
    <h2>Acceso</h2>
    <input type="email" id="email" placeholder="Correo">
    <input type="password" id="password" placeholder="Contraseña">
    <button id="registerBtn">Registrar</button>
    <button id="loginBtn">Ingresar</button>
    <button id="logoutBtn" style="display:none;">Salir</button>
  </div>

  <!-- Panel de administrador -->
  <div id="adminPanel" style="display:none;">
    <h2>Panel de Administrador</h2>
    <input type="text" id="prodName" placeholder="Nombre del producto">
    <input type="number" id="prodPrice" placeholder="Precio">
    <input type="number" id="prodQty" placeholder="Cantidad">
    <input type="text" id="prodImg" placeholder="URL de Imagen">
    <button id="addProductBtn">Agregar producto</button>
    <hr>
    <div id="productList"></div>
  </div>

  <!-- Lista de productos para usuarios -->
  <div id="storeFront">
    <h2>Productos disponibles</h2>
    <div id="publicProducts"></div>
  </div>

<script>
  const firebaseConfig = {
  apiKey: "AIzaSyA-uZsuRd7wB1WyfxWenkmVOgqWQLLi8Ak",
  authDomain: "inventario-jgs-33c05.firebaseapp.com",
  databaseURL: "https://inventario-jgs-33c05-default-rtdb.firebaseio.com",
  projectId: "inventario-jgs-33c05",
  storageBucket: "inventario-jgs-33c05.firebasestorage.app",
  messagingSenderId: "888894726369",
  appId: "1:888894726369:web:00b58c94c037a352d097a0",
  measurementId: "G-LCBWQCDW98"
};

  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const adminEmails = ["admin@empresa.com"];

  // Referencias a elementos
  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const registerBtn = document.getElementById("registerBtn");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const adminPanel = document.getElementById("adminPanel");
  const productList = document.getElementById("productList");
  const publicProducts = document.getElementById("publicProducts");

  // Registro
  registerBtn.addEventListener("click", () => {
    auth.createUserWithEmailAndPassword(email.value, password.value)
      .then(() => alert("Usuario registrado"))
      .catch(err => alert(err.message));
  });

  // Login
  loginBtn.addEventListener("click", () => {
    auth.signInWithEmailAndPassword(email.value, password.value)
      .catch(err => alert(err.message));
  });

  // Logout
  logoutBtn.addEventListener("click", () => auth.signOut());

  // Estado de autenticación
  auth.onAuthStateChanged(user => {
    if (user) {
      logoutBtn.style.display = "block";
      if (adminEmails.includes(user.email)) {
        adminPanel.style.display = "block";
        cargarProductosAdmin();
      } else {
        adminPanel.style.display = "none";
      }
      cargarProductosPublic();
    } else {
      logoutBtn.style.display = "none";
      adminPanel.style.display = "none";
    }
  });

  // Agregar producto
  document.getElementById("addProductBtn").addEventListener("click", () => {
    const name = document.getElementById("prodName").value;
    const price = parseFloat(document.getElementById("prodPrice").value);
    const qty = parseInt(document.getElementById("prodQty").value);
    const img = document.getElementById("prodImg").value;
    db.collection("productos").add({ name, price, qty, img })
      .then(() => alert("Producto agregado"));
  });

  // Cargar productos en el panel admin
  function cargarProductosAdmin() {
    db.collection("productos").onSnapshot(snapshot => {
      productList.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        productList.innerHTML += `
          <div>
            <b>${data.name}</b> - $${data.price} - Stock: ${data.qty}
            <button onclick="eliminarProducto('${doc.id}')">Eliminar</button>
          </div>`;
      });
    });
  }

  // Cargar productos para todos los usuarios
  function cargarProductosPublic() {
    db.collection("productos").onSnapshot(snapshot => {
      publicProducts.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        publicProducts.innerHTML += `
          <div>
            <img src="${data.img}" width="100"><br>
            <b>${data.name}</b><br>$${data.price}<br>
            Stock: ${data.qty}<br>
            <button onclick="comprarProducto('${doc.id}', ${data.qty})">Comprar</button>
          </div>`;
      });
    });
  }

  // Eliminar producto
  function eliminarProducto(id) {
    db.collection("productos").doc(id).delete();
  }

  // Comprar producto (reduce cantidad)
  function comprarProducto(id, qty) {
    if (qty > 0) {
      db.collection("productos").doc(id).update({ qty: qty - 1 });
    } else {
      alert("Sin stock disponible");
    }
  }

</script>
</body>
</html>
